
# TregProphylaxisPaper

Code repository for data processing and plotting included in our paper on the prophylactic use of Treg in murine BMT models.


## Description 

The repository is structured based on data packages that were analysed (mostly) independent from each other. This includes:

* Analysis of bulk RNA sequencing data ([bulkRNAseq_analysis](#bulkRNA) folder)
* Analysis of bulk TCR sequencing data ([bulkTCRseq_analyses](#bulkTCR) folder)
* Analysis of single cell RNA sequencing data ([scRNAseq_analysis](#scRNA) folder)
* Analysis of single cell TCR sequencing data ([scTCRseq_analysis](#scRNA) folder)
* Plotting of additional data (FACS, etc.) ([Rscripts](#R) & [data](#data) folder)
* Perl scripts used for processing or plotting ([perlScripts](#perl) folder)

<h3 id="bulkRNA">1. bulkRNAseq_analyses</h3>

Description provided by David....

<h3 id="bulkTCR">2. bulkTCRseq_analyses</h3>

The code for processing and analysis of the TCR data is provided in several bash scripts, which either call perl or R scripts for analyses and plotting.

<h4>Commands_bulkTCR_mapping.sh</h4>
Includes the code for mapping the TCRseq data using the MIXCR pipeline.

<h4>Commands_bulkTCR_TregExpansion.sh</h4>
Includes the code for the processing of TRA/TRB clonotype data of in vitro expansions of Treg cells. Calls two Rscripts to generate Figures 1c and S1a.

<h4>Commands_bulkTCR_GvHD.sh</h4>
Includes the code for the processing of TRA/TRB clonotype data of Treg reisolated from transplantations in the prophylaxis (GvHD) setting. It generates circos plots of clonotype overlaps (Figures 5a & S5a)and triangular presentations of clonotype weights in barycentric coordinates (Figures 5b,c & S5d,e).

<h4>Commands_bulkTCR_noGvHD.sh</h4>
Includes the code for the processing of TRA/TRB clonotype data of Treg reisolated from transplantations in the control (no Tconv, noGvHD) setting. It generates circos plots of clonotype overlaps (Figures S5b-c) and triangular presentations of clonotype weights in barycentric coordinates (Figures S5f-i).

<h4>Commands_bulkTCR_noBMT.sh</h4>
Includes the code for the processing of TRA/TRB clonotype data of resident Treg isolated from wildtype donor mice. Calls an Rscripts to generate Figure 5g.

<h4>Commands_bulkTCR_BMT.sh</h4>
Includes the code for the analysing combined TRA/TRB clonotype data of Treg reisolated from transplantations in the noGvHD & GvHD settings. Generates barcode plots for TRB clonotype distributions shown in Figures 5d, and Figures S5j,k,l. Also provides code for Figures related to TRBV segment analyses including plots shown in Figure 5e,f & S5m (generated using Rscript) as well as additional barcode plots shown in Figure S5n.

####Rscripts folder
Contains .rds files that are rendered as part of the analyses commands described above as well as corresponding Session Infos.


<h3 id="scRNA">3. scRNAseq_analyses</h3>

Description provided by Nick....

<h3 id="scTCR">4. scTCRseq_analyses</h3>

Description provided by Michael....

<h3 id="R">5. Rscripts</h3>

Contains .rds files that are rendered locally using data provided in the [data](#data) folder as well as corresponding Session Infos. This includes the code underlying Figures 1b,d & 2d,e.

<h3 id="data">6. data</h3>

Contains data for Figures 1b,d & 2d,e.

<h3 id="data">7. perlScripts</h3>

related to bulk TCR repertoire aligning:

#### TCRmixcrV3.1.pl
Perl script to map TCR repertoires derived from our RACE-PCR approach. Sequencing data (usually MiSeq 300bp PE) are initially assembled (paired) using the software PEAR. UMI should be standard in our protocol, but the pipeline can also be used for non-barcoded RNAs (when -UMI option is omitted). MIGs are called using MIGEC before mapping with MIXCR (version 3). We usually run two libraries for each sample (replicate) and work with the combined repertoire from both technical replicate runs. Individual runs are kept for quality controls.
The pipeline is setup for our server and deploys folders for each experiment on the misc/data volume under processedData//mapping/RNA/RepSeq/MIXCRv3/. ***Dependencies:*** PEAR (v0.9.11), MIGEC (v1.2.9), MIXCR (v3.0.13), R version 4.0.3 (rbioc_3-12)


related to bulk TCR repertoire analyses:

Many analyses can be done in R, but for two types of presentations (Circos plot of clonotype overlap, and barycentric distributions of clonotype weights), we have a set of  Perl scripts that perform preprocessing/reformating of the data (bulkTCRparseImmunArch.pl, bulkTCRcreateJoinedCountTable.pl) and one each for the plotting (bulkTCRCirculizeFreq4Samples.pl, bulkTCRtriangle.pl)

#### bulkTCRparseImmunArch.pl
Perl script to reformat the data table generated by the immunoarch R package to fit into our count table joining script.

#### bulkTCRcreateJoinedCountTable.pl
Perl script generating joined clonotype tables from several samples. Accepts files generated by the bulkTCRparseImmunArch.pl script.
#### bulkTCRCirculizeFreq4Samples.pl
Perl script that generates a circos plot for clonotype overlaps in exactly four samples. This is tailored for our three animal/one donor design and shows how much overlap there is between donors and recipient organs. ***Dependencies:*** R version 4.0.3 (rbioc_3-12), R packages: circlize, RColorBrewer, gridExtra, grid 
#### bulkTCRtriangle.pl
erl script that calculates weights of clonotype counts for three sample comparisons and  generates a bubble plot using barycentric coordinates by generating and calling a R script. This is a nice way to demonstrate the contribution of each of the three samples to the top clonotypes in the comparison. It accepts clonotypeTable files generated with the bulkTCRcreateJoinedCountTable.pl (best to restrict to some 100 top clones). ***Dependencies:*** R version 4.0.3 (rbioc_3-12), ggplot2 R package

related to sc TCR repertoire analyses

#### scTCRparseImmunArch.pl, scTCRcreateJoinedCountTable.pl, scTCRCirculizeFreq4Samples.pl, scTCRtriangle.plPerl scripts equivalent to the corresponding bulkTCR script set - set up to work with cell ranger data.#### scTCRcreateTRBVCountTable.plScript to extract only TRB information from scTCRseq data. 
