---
title: "Figure2d_Treg7dafterBMT_inVivoDistribution"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath(".."))
knitr::write_bib(.packages(), "packages.bib")
```

## Bar charts showing the cell counts for re-isolated Treg 

R packages

```{r}
library(ggplot2)
library(scales)
library(car)
```

data formating 

```{r}
Treg.data <- read.delim("./data/TregDistribution.txt", header=TRUE)
Treg.data$organ <- factor(Treg.data$organ,levels = c("BM","Spleen","Liver","mLN","Colon"))
Treg.data$category <- factor(Treg.data$category,levels = c("organ_resident","allo_noGvHD","allo_GvHD","poly_noGvHD","poly_GvHD"))
```

generating the plot for Figure 2d

```{r}
p <- ggplot(Treg.data, aes(x=category, y=count, fill=category)) + coord_cartesian(ylim = c(1000,30000000))
p <- p + stat_summary(fun = mean, geom = "bar",  position=position_dodge(.9))
p <- p + geom_dotplot(binaxis='y', stackdir='center',  position=position_dodge(.9), dotsize=6.5, stackratio = 1, binwidth=.02) 
p <- p + stat_summary(fun.data=mean_sdl, fun.args = list(mult=1), geom="errorbar", color="black", size=0.5, width = 0.6, position=position_dodge(.9))
p <- p + scale_y_log10(breaks = c(1000,10000,100000,1000000,10000000),labels = trans_format("log10", math_format(10^.x)),expand = c(0, 0)) 
p <- p + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.text.x = element_text(angle = 90), text = element_text(size = 24))
p <- p + scale_fill_manual(values = c("gray","orange","darkorange","steelblue2","steelblue3"))
p <- p + annotation_logticks(sides="l", short = unit(.25,"mm"), mid = unit(.5,"mm"),   long = unit(1,"mm"))  
p <- p + labs(title="re-isolated Treg (GvHD)",x="organ", y = "cells per organ")
p <- p + facet_wrap(~organ, nrow=1)
p
pdf("./figures/TregOrganDist.pdf", height=5.5, width=9)
p
dev.off()
```

## Statistics

running statistical testing 
homogeneity of variance assumption: levene
normality assumpttion: shapiro
Anova with Tukey

(adding corresponding bars and asterisks to the plot in Adobe Illustrator)

```{r}
Treg.data$category <- factor(Treg.data$category,levels = c("organ_resident","allo_noGvHD","poly_noGvHD","allo_GvHD","poly_GvHD"))
Treg.dataLiver <- Treg.data[ which(Treg.data$organ=='Liver' & (Treg.data$type=='GvHD' | Treg.data$type=='noGvHD')), ]
Treg.dataColon <- Treg.data[ which(Treg.data$organ=='Colon' & (Treg.data$type=='GvHD' | Treg.data$type=='noGvHD')), ]
Treg.dataSpleen <- Treg.data[ which(Treg.data$organ=='Spleen' & (Treg.data$type=='GvHD' | Treg.data$type=='noGvHD')), ]
```

### liver Treg.data

```{r}
leveneTest(count~category, data=Treg.dataLiver, center=mean)  # variance is significantly different 
shapiro.test(Treg.dataLiver$count[1:6]) 						 # significantly different
shapiro.test(Treg.dataLiver$count[7:12])						 # n.s.
shapiro.test(Treg.dataLiver$count[13:18])                      # n.s.

Treg.liver.res.aov <- aov(count~category, data=Treg.dataLiver)
summary (Treg.liver.res.aov)
```

liver Treg.data (outlyer removed)

```{r}
Treg.dataLiverRed <- Treg.dataLiver[c(1:4,7:10,13:16),]
leveneTest(count~category, data=Treg.dataLiverRed, center=mean)  # n.s 
shapiro.test(Treg.dataLiver$count[1:4]) 						 # n.s
shapiro.test(Treg.dataLiver$count[7:10])						 # n.s.
shapiro.test(Treg.dataLiver$count[13:16])                      # n.s.

Treg.liver.red.res.aov <- aov(count~category, data=Treg.dataLiverRed)
summary (Treg.liver.red.res.aov)
```

no significant differences

### spleen Treg.data

```{r}
leveneTest(count~category, data=Treg.dataSpleen, center=mean)  # n.s.
shapiro.test(Treg.dataSpleen$count[1:6]) 						 # n.s.
shapiro.test(Treg.dataSpleen$count[7:12])						 # n.s.
shapiro.test(Treg.dataSpleen$count[13:19])                      # n.s.
shapiro.test(Treg.dataSpleen$count[20:25])                      # n.s.

Treg.spleen.res.aov <- aov(count~category, data=Treg.dataSpleen)
summary (Treg.spleen.res.aov)
```
```{r}
TukeyHSD(Treg.spleen.res.aov)
```

allo_GvHD-allo_noGvHD p<0.01 **



### colon Treg.data

```{r}
leveneTest(count~category, data=Treg.dataColon, center=mean)  # n.s.
shapiro.test(Treg.dataColon$count[1:6]) 						 # n.s.
shapiro.test(Treg.dataColon$count[7:12])						 # n.s.
shapiro.test(Treg.dataColon$count[13:19])                      # n.s.
shapiro.test(Treg.dataColon$count[20:25])                      # n.s.

Treg.colon.res.aov <- aov(count~category, data=Treg.dataColon)
summary (Treg.colon.res.aov)
```
no significant differences



```{r}
sessionInfo(package = NULL)
writeLines(capture.output(sessionInfo(package = NULL)), "./Rscripts/Figure2d_Treg7dafterBMT_inVivoDistribution_SessionInfo.txt")
```